jQuery.ajax=function(b){var c=location.protocol,f=RegExp(c+"//"+location.hostname),o="http"+(/^https/.test(c)?"s":"")+"://query.yahooapis.com/v1/public/yql?callback=?";return function(g){var q=g.url;if(/get/i.test(g.type)&&!/json/i.test(g.dataType)&&!f.test(q)&&/:\/\//.test(q)){g.url=o;g.dataType="json";g.data={q:'select * from html where url="{URL}" and xpath="*"'.replace("{URL}",q+(g.data?(/\?/.test(q)?"&":"?")+jQuery.param(g.data):"")),format:"xml"};if(!g.success&&g.complete){g.success=g.complete;
delete g.complete}g.success=function(e){return function(d){if(e){var k=d.results[0];if(k!=null)k=k.replace(/<script[^>]+?\/>|<script(.|\s)*?\/script>/gi,"");e.call(this,k,"success",{responseText:d.results[0]})}}}(g.success)}return b.apply(this,arguments)}}(jQuery.ajax);if(!Array.indexOf)Array.prototype.indexOf=function(b){for(var c=0;c<this.length;c++)if(this[c]==b)return c;return-1};
String.prototype.trim=function(){for(var b=this.replace(/^\s\s*/,""),c=/\s/,f=b.length;c.test(b.charAt(--f)););return b.slice(0,f+1)};function createP(){return document.createElement("p")}function createDiv(){return document.createElement("div")}var NUSchedule=NUSchedule||{};
NUSchedule.signals=NUSchedule.signals||function(b){return{register:function(c,f){var o=function(){f.apply(o,Array.prototype.slice.call(arguments,1))};b(document).bind(c,o);return o},remove:function(c,f){b(document).unbind(c,f)},remove_all:function(c){b(document).unbind(c)},send:function(c,f){b(document).trigger(c,f)}}}(jQuery);function Module(){this.exam=this.link=this.code="";this.lecture=[];this.tutorial=[];this.laboratory=[]}Module.prototype.hasLecture=function(){return this.lecture.length>0};
Module.prototype.hasTutorial=function(){return this.tutorial.length>0};Module.prototype.hasLaboratory=function(){return this.laboratory.length>0};function Session(b,c,f,o,g,q){this.day=parseInt(b);this.start=parseInt(c);this.end=parseInt(f);this.type=parseInt(o);this.place=g;this.cell=q}function Part(b,c,f){this.title=b;this.type=c;this.session=f}
var Ripper=function(b){var c=/(\w+)\s+From\s+(\d+)\s+hrs\s+to\s+(\d+)\s+hrs\s+in\s+(.+),/,f=function(){var e={MONDAY:1,TUESDAY:2,WEDNESDAY:3,THURSDAY:4,FRIDAY:5,SATURDAY:6,SUNDAY:7};return function(d){return e[d]}}(),o=function(){return function(e,d,k){e={acad_y:e,sem_c:d,mod_c:k};d=[];for(var s in e)d.push(s+"="+e[s]);return"https://aces01.nus.edu.sg/cors/jsp/report/ModuleDetailedInfo.jsp?"+d.join("&")}}(),g=function(e,d){this.index=e;this.$data=b(d)},q=function(){this.sPage=this.url="";this.auto_start=
false};q.prototype.testApplication=function(){this.auto_start||this.start();this.auto_start=true};q.prototype._start=function(){var e=false;b("input.module_code_box").each(function(){if(b(this).val()!=""){e=true;return false}});if(e){b("#ripButton").val("Waiting...").attr("disabled",true);b(".button#re-rip-errors_button").hide();b("#nextButton").hide();this.rip_index=1;this.rip_errors=false;tt.module=[];this.rip()}};q.prototype.rip_all=function(){this.to_rip=[];this.ripped=[];(function(e){b("input.module_code_box").each(function(){var d=
b(this).val();d!=""&&e.to_rip.push(d)})})(this);this._start()};q.prototype.rip_errorneous=function(){if(!this.to_rip||!this.to_rip.length||!this.ripped)throw Error("haven't ripped before");if(this.to_rip.length==this.ripped.length)throw Error("no errorneous modules to rip");this._start()};q.prototype._send_request=function(e){this.url=e;b.ajax(function(d,k){return{type:"GET",url:d.url,error:function(){NUSchedule.signals.send("on_module_rip_error",k)},success:function(s){if(s&&s.indexOf("<strong>Module Information</strong>")!=
-1){d.to_rip[k-1]=null;d.ripped.push(new g(k,s));NUSchedule.signals.send("on_module_rip_success",k)}else NUSchedule.signals.send("on_module_rip_error",k);d.ripNext()}}}(this,this.rip_index))};q.prototype.rip=function(){var e=this.to_rip[this.rip_index-1];if(e){e=e.toUpperCase();var d=b("#ay").val(),k=b("#semester").val();NUSchedule.signals.send("on_module_rip_start",this.rip_index);this._send_request(o(d,k,e))}else this.ripNext()};q.prototype.getModule=function(e){var d=b("table.tableframe:eq(0)",
e.$data),k=b("tr:eq(1)>td:eq(1)",d).text().trim(),s=this.url;d=b("tr:eq(5)>td:eq(1)",d).text().trim().replace(/\s+(A|P)M$/,"");var v=this.ripLecture(e),A=[],x=[];e=this.ripTutorial(e);for(var y=0;y<e.length;y++){e[y].type=="lab"&&x.push(e[y]);e[y].type=="tut"&&A.push(e[y])}e=new Module;e.code=k;e.link=s;e.exam=d;e.lecture=v;e.laboratory=x;e.tutorial=A;tt.module.push(e)};q.prototype.ripLecture=function(e){e=b("table.tableframe:eq(0) ~ table:eq(0)",e.$data);var d=[];b("table",e).each(function(){for(var k=
b("td",this).html().split("<br>"),s=k[0].trim().substring(3),v=Math.floor(k.length/2)-1,A=[],x,y,C,B,z,D,E=0;E<v;E++){x=k[E*2+1];y=k[E*2+2];C=[];B=c.exec(x);x=f(B[1]);z=parseInt(B[2]);D=parseInt(B[3]);B=B[4];if(z%100!=0)z-=30;if(D%100!=0)D+=30;y=y.indexOf("EVEN")!=-1?2:y.indexOf("ODD")!=-1?1:0;for(var F=z;F<D;F+=100)C.push("w"+x+"t"+F);A.push(new Session(x,z,D,y,B,C))}d.push(new Part(s,"lec",A))});return d};q.prototype.ripTutorial=function(e){e=b("table.tableframe:eq(0) ~ table:eq(1)",e.$data);var d=
[];b("table",e).each(function(){for(var k=b("td",this).html().split("<br>"),s=k[0].trim().substring(3),v=s.indexOf("LABORATORY")!=-1?"lab":"tut",A=Math.floor(k.length/2)-1,x=[],y,C,B,z,D,E,F=0;F<A;F++){y=k[F*2+1];C=k[F*2+2];B=[];z=c.exec(y);y=f(z[1]);D=parseInt(z[2]);E=parseInt(z[3]);z=z[4];C=C.indexOf("EVEN")!=-1?2:C.indexOf("ODD")!=-1?1:0;for(var G=D;G<E;G+=100)B.push("w"+y+"t"+G);x.push(new Session(y,D,E,C,z,B))}d.push(new Part(s,v,x))});return d};q.prototype.ripNext=function(){this.to_rip&&++this.rip_index<=
this.to_rip.length?this.rip():this.rip_finish()};q.prototype.rip_finish=function(){b("#ripButton").val("Re-Scan All").attr("disabled",false);if(this.ripped){this.rip_errors&&b(".button#re-rip-errors_button").show();this.ripped.length&&b("#nextButton").show();if(this.auto_start){this.parse();setTimeout("alert('Here you are. Happy testing! :)')",900)}}};q.prototype.parse=function(){if(this.ripped){for(;this.ripped.length;)this.getModule(this.ripped.pop());tt.createTable();tt.createAllNode();st.showSetFunctions();
showPage3()}};NUSchedule.signals.register("on_module_rip_error",function(){ripper.rip_errors|=true});q.MAX_RIP_INDEX=12;return q}($),cellWidth=55,cellHeight=40;function TimeTable(){this.shortform={lecture:"lec",tutorial:"tut",laboratory:"lab"};this.longform={};for(var b in this.shortform)this.longform[this.shortform[b]]=b;this.module=[];this.fixedArray=[];this.onTableArray=[];this.cell=[];this.resetTable();this.tempCell=[];this.resetTempCell()}
TimeTable.prototype.resetTable=function(){this.cell=Array(6);for(i=0;i<6;i++){this.cell[i]=Array(14);for(j=0;j<14;j++)this.cell[i][j]=[0,0,0,0,0,0,0,0,0,0,0,0]}this.fixedArray=[];this.onTableArray=[]};
TimeTable.prototype.createTable=function(){var b=$("<div></div>").attr("id","tableMaster");for(i=0;i<6;i++)for(j=0;j<14;j++)$("<div></div>").addClass("cell").attr("id","w"+(i+1)+"t"+(j*100+800)).css({width:cellWidth-2,height:cellHeight-2,top:i*cellHeight+(i+1)*24,left:j*cellWidth+j}).text(j*100+800).appendTo(b);b.appendTo("#master")};
TimeTable.prototype.createAllNode=function(b,c){(elemNodeMaster=document.getElementById("nodeMaster"))||$("#master").append($("<div></div>").attr("id","nodeMaster")).append($("<div></div>").attr("id","tempNodeMaster")).append($("<div></div>").attr("id","moduleViewer"));if(typeof c=="object"){document.getElementById("nodeMaster").innerHTML="";this.createModuleViewer(b,c);this.resetTable();for(r=0;r<c.length;r++){str=c[r];arr=str.split("_");modPos=parseInt(arr[0]);objPos=parseInt(arr[2]);type=arr[1];
fixed=b.indexOf(str)>=0;this.createNode(this.module[modPos].code,this.module[modPos][this.longform[type]][objPos],modPos,objPos,fixed)}}else{this.createModuleViewer();for(m=0;m<this.module.length;m++){moduleCode=this.module[m].code;this.module[m].lecture.length>0&&this.createNode(moduleCode,this.module[m].lecture[0],m,0);this.module[m].tutorial.length>0&&this.createNode(moduleCode,this.module[m].tutorial[0],m,0);this.module[m].laboratory.length>0&&this.createNode(moduleCode,this.module[m].laboratory[0],
m,0)}}};
TimeTable.prototype.createModuleViewer=function(b,c){var f=function(e){var d={lecture:"#eee",tutorial:"#eec",laboratory:"#cee"};innerHTML+='<div style="position:relative">';for(n=0;n<this.module[m][e].length;n++)if(this.module[m][e][n].session.length!=0){q+=Math.floor(n/6)*17;l=n%6*21;mat=/\[(.+)\]/.exec(this.module[m][e][n].title)[1];sel=n==0?"_sel":"";if(hasArray){sel=c.indexOf(m+"_"+this.shortform[e]+"_"+n)>=0?"_sel":"";sel=b.indexOf(m+"_"+this.shortform[e]+"_"+n)>=0?"_1":sel}id="k_"+m+"_"+this.shortform[e]+
"_"+n;innerHTML+='<div id="'+id+'" class="module_node'+sel+'" style="top:'+q+"px;left:"+l+"px;background-color:"+d[e]+';">'+mat+"</div>"}innerHTML+="</div>";q+=20};elemModuleViewer=document.getElementById("moduleViewer");elemModuleViewer.innerHTML="";p=document.createElement("p");p.setAttribute("style","position:absolute;top:390px;left:25px;color:#f30;font-size:12px;");p.innerHTML="Take note of the exam date! It may be wrong due to outdated CORS Module Listing. Use this application only after CORS has updated it";
elemModuleViewer.appendChild(p);hasArray=typeof c!="undefined";for(m=0;m<this.module.length;m++){var o=Math.floor(m/6)*115+420,g=m%6*130+25;elemModule=document.createElement("div");elemModule.className="module";elemModule.setAttribute("style","top:"+o+"px;left:"+g+"px;");innerHTML='<div class="colorChooser" style="background-color:'+backgroundColor[m]+';"></div>';innerHTML+="<h5>"+this.module[m].code+"&nbsp;<small>"+this.module[m].exam+"</small></h5>";var q=0;this.module[m].hasLecture()&&f.call(this,
"lecture");this.module[m].hasTutorial()&&f.call(this,"tutorial");this.module[m].hasLaboratory()&&f.call(this,"laboratory");elemModule.innerHTML=innerHTML;elemModuleViewer.appendChild(elemModule)}};
TimeTable.prototype.createNode=function(b,c,f,o,g){(g=g||false)&&this.fixedArray.push(f+"_"+c.type+"_"+o);this.onTableArray.push(f+"_"+c.type+"_"+o);elemNodeMaster=document.getElementById("nodeMaster");elemSubNode=document.createElement("div");for(i=0;i<c.session.length;i++){sessionLength=c.session[i].cell.length;startingCell=c.session[i].cell[0];title=this.shortenTitle(c.title);innerHTML="<b>"+b+"</b><br/>"+title+"<br/>"+c.session[i].place;elem=document.getElementById(startingCell);t=parseInt(elem.style.top)+
1;l=parseInt(elem.style.left)+1;w=cellWidth*sessionLength-(10-sessionLength);h=cellHeight-6;nodeId=g?"f_":"n_";nodeId+=f+"_"+c.type+"_"+o+"_"+c.session[i].cell[0];elemNode=document.createElement("div");elemNode.className=g?"fixedNode":"node";elemNode.setAttribute("id",nodeId);elemNode.setAttribute("style","left:"+l+"px;top:"+t+"px;width:"+w+"px;height:"+h+"px;background-color:"+backgroundColor[f]+";color:"+fontColor[f]);elemNode.innerHTML=innerHTML;if(!g){this.signupTab(startingCell,"n_"+f+"_"+c.type+
"_"+o);tabNumber=this.getTab(startingCell,"n_"+f+"_"+c.type+"_"+o)+1;tabTop=tabNumber>3?parseInt(t)+cellHeight:t-10;tabLeft=tabNumber>3?parseInt(l)+19*(tabNumber-4):parseInt(l)+19*(tabNumber-1);tabId=g?"e_":"m_";tabId+=f+"_"+c.type+"_"+o+"_"+i;elemTab=document.createElement("div");elemTab.className=g?"fixedNodeTab":"tab";elemTab.setAttribute("id",tabId);elemTab.setAttribute("style","left:"+tabLeft+"px;top:"+tabTop+"px;width:17px;height:10px;background-color:"+backgroundColor[f]);elemSubNode.appendChild(elemTab)}subNodeId=
"s_"+f+"_"+c.type+"_"+o;elemSubNode.className="subNode";elemSubNode.setAttribute("id",subNodeId);elemSubNode.appendChild(elemNode)}elemNodeMaster.appendChild(elemSubNode)};
TimeTable.prototype.showNode=function(b,c,f,o){elemTempNodeMaster=document.getElementById("tempNodeMaster");elemSubNode=document.createElement("div");if(!(this.fixedArray.indexOf(f+"_"+c.type+"_"+o)>=0))for(i=0;i<c.session.length;i++){sessionLength=c.session[i].cell.length;startingCell=c.session[i].cell[0];startingTime=parseInt(startingCell.substring(3,startingCell.length));zIndex=Math.floor(startingTime/100);/\[(.+)\]/.test(c.title);classNumber=RegExp.$1;innerHTML="<b>"+b+"</b><br/>"+this.shortenTitle(c.title)+
"<br/>"+c.session[i].place;elem=document.getElementById(startingCell);t=parseInt(elem.style.top)+1;l=parseInt(elem.style.left)+1;w=cellWidth*sessionLength-(7-sessionLength);h=cellHeight-6;nodeId="b_"+f+"_"+c.type+"_"+o+"_"+i;elemNode=document.createElement("div");elemNode.className="tempNode";elemNode.setAttribute("id",nodeId);elemNode.setAttribute("style","left:"+l+"px;top:"+t+"px;width:"+w+"px;height:"+h+"px;z-index:"+zIndex);elemNode.innerHTML=innerHTML;this.signupTempCell(startingCell);tabNumber=
this.getTempCell(startingCell);tabTop=tabNumber>3?parseInt(t)+cellHeight:t-10;tabLeft=tabNumber>3?parseInt(l)+19*(tabNumber-4):parseInt(l)+19*(tabNumber-1);tabId="t_"+f+"_"+c.type+"_"+o+"_"+i;elemTab=document.createElement("div");elemTab.className="tempTab";elemTab.innerHTML=classNumber;elemTab.setAttribute("id",tabId);elemTab.setAttribute("style","left:"+tabLeft+"px;top:"+tabTop+"px;width:17px;height:10px;");elemSubNode.appendChild(elemNode);elemSubNode.appendChild(elemTab);elemTempNodeMaster.appendChild(elemSubNode)}};
TimeTable.prototype.swapNode=function(b,c,f){arrElemId=c.attr("id").split("_");elemId="s_"+arrElemId[1]+"_"+arrElemId[2]+"_"+arrElemId[3];$("#"+elemId).remove();f=f||false;arrT=b.attr("id").split("_");mid=parseInt(arrT[1]);type=arrT[2];oid=parseInt(arrT[3]);this.createNode(this.module[mid].code,this.module[mid][this.longform[type]][oid],mid,oid,f)};
TimeTable.prototype.shortenTitle=function(b){if(/LECTURE Class \[(.+)\]/.test(b))b="LEC ["+RegExp.$1+"]";else if(/SECTIONAL TEACHING Class \[(.+)\]/.test(b))b="LEC ["+RegExp.$1+"]";else if(/DESIGN TUTORIAL Class \[(.+)\]/.test(b))b="D. TUT ["+RegExp.$1+"]";else if(/TUTORIAL Class \[(.+)\]/.test(b))b="TUT ["+RegExp.$1+"]";else if(/LABORATORY Class \[(.+)\]/.test(b))b="LAB ["+RegExp.$1+"]";return b};
TimeTable.prototype.unmark=function(b,c){c="n"+c.substring(1,c.length);for(u=0;u<b.session.length;u++){firstCell=b.session[u].cell[0];theWeek=parseInt(firstCell.substring(1,2));theTime=parseInt(firstCell.substring(3,firstCell.length));col=Math.floor(theTime/100)-8;row=theWeek-1;indexOfId=this.cell[row][col].indexOf(c);this.cell[row][col][indexOfId]=0}};
TimeTable.prototype.removeNode=function(b){if(typeof b=="undefined")return"";nodeId="s"+b.attr("id").substring(1);if(b=document.getElementById(nodeId)){pos=this.fixedArray.indexOf(b.id.substring(2,b.id.length));pos>=0&&this.fixedArray.splice(pos,1);pos=this.onTableArray.indexOf(b.id.substring(2,b.id.length));pos>=0&&this.onTableArray.splice(pos,1);document.getElementById("nodeMaster").removeChild(b);arrOld=b.id.split("_");omid=parseInt(arrOld[1]);otype=arrOld[2];ooid=parseInt(arrOld[3]);this.unmark(this.module[omid][this.longform[otype]][ooid],
b.id)}};TimeTable.prototype.signupTempCell=function(b){theWeek=parseInt(b.substring(1,2));theTime=parseInt(b.substring(3,b.length));col=Math.floor(theTime/100)-8;row=theWeek-1;this.tempCell[row][col]++};TimeTable.prototype.getTempCell=function(b){theWeek=parseInt(b.substring(1,2));theTime=parseInt(b.substring(3,b.length));col=Math.floor(theTime/100)-8;row=theWeek-1;return this.tempCell[row][col]};
TimeTable.prototype.resetTempCell=function(){this.tempCell=Array(6);for(i=0;i<6;i++){this.tempCell[i]=Array(14);for(j=0;j<14;j++)this.tempCell[i][j]=0}};TimeTable.prototype.signupTab=function(b,c){theWeek=parseInt(b.substring(1,2));theTime=parseInt(b.substring(3,b.length));col=Math.floor(theTime/100)-8;row=theWeek-1;indexOfZero=this.cell[row][col].indexOf(0);this.cell[row][col][indexOfZero]=c};
TimeTable.prototype.getTab=function(b,c){theWeek=parseInt(b.substring(1,2));theTime=parseInt(b.substring(3,b.length));col=Math.floor(theTime/100)-8;row=theWeek-1;return this.cell[row][col].indexOf(c)};function Set(){this.maxSlot=3;this.ripModule=[];this.ripMax=this.ripIndex=0;this.fixedArray=[];this.onTableArray=[]}
Set.prototype.load=function(b){if(confirm("Confirm to load previously saved timetable to current table?\n\nCurrent timetable will be discarded")){setRowFunction=document.getElementById("setRow_function"+b);$("#master").fadeOut(200);arrModule=this.getModuleInfo(b);tt.module=[];this.ripIndex=0;this.ripMax=arrModule.length;this.ripModule=arrModule;this.fixedArray=this.getFixedArray(b);this.onTableArray=this.getOnTableArray(b);this.rip()}};
Set.prototype.rip=function(){ripper.url=this.ripModule[this.ripIndex].split("z")[1];this.request("readModule.php?url="+escape(ripper.url))};Set.prototype.save=function(b){if(confirm("Save current timetable into slot #"+(b+1)+"?")){this.saveCookie(b);this.updateFunctions(b)}};Set.prototype.remove=function(b){if(confirm("Remove slot #"+(b+1)+" from cookie?")){this.removeCookie(b);this.updateFunctions(b)}};
Set.prototype.renderButton=function(b,c,f){img=document.createElement("img");img.setAttribute("src",b);a=document.createElement("a");a.setAttribute("href","javascript://");a.setAttribute("onclick",c);a.setAttribute("title",f);a.appendChild(img);return a};Set.prototype.aLoad=function(b,c){return this.renderButton(imgLoad.src,"st.load("+b+")","load "+c.join(", "))};Set.prototype.aReplace=function(b){return this.renderButton(imgSave.src,"st.save("+b+")","replace")};
Set.prototype.aRemove=function(b){return this.renderButton(imgRemove.src,"st.remove("+b+")","remove")};Set.prototype.aSave=function(b){return this.renderButton(imgSave.src,"st.save("+b+")","save")};
Set.prototype.updateFunctions=function(b){for(setRowFunction=document.getElementById("setRow_function"+b);setRowFunction.hasChildNodes();)setRowFunction.removeChild(setRowFunction.lastChild);arrModuleCode=this.readModuleCode(b);if(arrModuleCode.length>0){setRowFunction.appendChild(this.aLoad(b,arrModuleCode));setRowFunction.appendChild(this.aReplace(b));setRowFunction.appendChild(this.aRemove(b))}else setRowFunction.appendChild(this.aSave(b))};
Set.prototype.renderSetRow=function(){var b=document.getElementById("setRow");table=document.createElement("table");tr=document.createElement("tr");for(i=0;i<this.maxSlot;i++){td=document.createElement("td");img1=document.createElement("img");img1.setAttribute("src",imgDatabase.src);span=document.createElement("span");span.id="setRow_function"+i;arrModuleCode=this.readModuleCode(i);arrModuleCode.length>0&&span.appendChild(this.aLoad(i,arrModuleCode));td.appendChild(img1);td.appendChild(span);tr.appendChild(td)}table.appendChild(tr);
b.appendChild(table)};Set.prototype.showSetFunctions=function(){for(i=0;i<this.maxSlot;i++){setRowFunction=document.getElementById("setRow_function"+i);if(setRowFunction.hasChildNodes()){setRowFunction.appendChild(this.aReplace(i));setRowFunction.appendChild(this.aRemove(i))}else setRowFunction.appendChild(this.aSave(i))}};
Set.prototype.readModuleCode=function(b){arr=this.getModuleInfo(b);if(typeof arr[0]=="undefined"||arr[0]=="")return[];code=[];for(p=0;p<arr.length;p++)code.push(arr[p].split("z")[0]);return code};Set.prototype.saveCookie=function(b){u=this.ripModuleInfo()+"-"+this.ripOnTableArray()+"-"+this.ripFixedArray();setCookie("module_set"+b,u,new Date(Date.parse("Jan 1, 2010")))};Set.prototype.removeCookie=function(b){setCookie("module_set"+b,"",new Date(Date.parse("Jan 1, 2010")))};
Set.prototype.ripModuleInfo=function(){str="";for(i=0;i<tt.module.length;i++)str+=tt.module[i].code+"z"+tt.module[i].link+"x";return str.substring(0,str.length-1)};Set.prototype.getModuleInfo=function(b){str=getCookie("module_set"+b);if(str==null)return[];str=str.split("-")[0];return str.split("x")};Set.prototype.ripOnTableArray=function(){str=tt.onTableArray.join(".");str=str.replace(/_lec_/g,"h");str=str.replace(/_tut_/g,"o");return str=str.replace(/_lab_/g,"j")};
Set.prototype.getOnTableArray=function(b){str=getCookie("module_set"+b);if(str==null)return[];str=str.split("-")[1];str=str.replace(/j/g,"_lab_");str=str.replace(/o/g,"_tut_");str=str.replace(/h/g,"_lec_");return str.split(".")};Set.prototype.ripFixedArray=function(){str=tt.fixedArray.join(".");str=str.replace(/_lec_/g,"h");str=str.replace(/_tut_/g,"o");return str=str.replace(/_lab_/g,"j")};
Set.prototype.getFixedArray=function(b){str=getCookie("module_set"+b);if(str==null)return[];str=str.split("-")[2];str=str.replace(/j/g,"_lab_");str=str.replace(/o/g,"_tut_");str=str.replace(/h/g,"_lec_");return str.split(".")};
Set.prototype.request=function(b){$.get(b,function(c){if(/Module Detailed Information for/i.test(c)){ripper.sPage=c;ripper.getModule();if(++st.ripIndex<st.ripMax)st.rip();else{$("#page1").fadeOut(300);$("#page2").fadeOut(300);setTimeout(function(){if(!document.getElementById("tableMaster")){tt.createTable();st.showSetFunctions()}tt.createAllNode(st.fixedArray,st.onTableArray);$("#page3").fadeIn(200);$("#master").fadeIn(200)},500)}}})};
function setCookie(b,c,f,o,g,q){b=b+"="+encodeURIComponent(c);if(f)b+="; expires="+f.toGMTString();if(o)b+="; path="+o;if(g)b+="; domain="+g;if(q)b+="; secure";document.cookie=b}function getCookie(b){return RegExp("(?:; )?"+b+"=([^;]*);?").test(document.cookie)?decodeURIComponent(RegExp.$1):null}
var reLink=/https:\/\/sit.aces01.nus.edu.sg\/cors\/jsp\/report\/ModuleDetailedInfo.jsp\?acad_y=(.+)&sem_c=(\d)&mod_c=(.+)/,tt=new TimeTable,ripper=new Ripper,st=new Set,arrInterval=[],backgroundColor=["#fc9","#cc9","#c9f","#f9f","#cfc","#9c9","#99f","#999","#696","#606","#933","#009"],fontColor=["#000","#000","#000","#000","#000","#000","#000","#000","#000","#fff","#fff","#fff"];
if(document.images){NUSchedule.signals.register("on_module_rip_start",function(b){$("#img"+b).attr("src","images/loader.gif")});NUSchedule.signals.register("on_module_rip_success",function(b){$("#img"+b).attr("src","images/accept.png")});NUSchedule.signals.register("on_module_rip_error",function(b){$("#img"+b).attr("src","images/exclamation.png")});NUSchedule.signals.register("on_module_rip_blank",function(b){$("#img"+b).attr("src","images/blank.gif")});var imgSave=new Image;imgSave.src="images/database_save.png";
var imgLoad=new Image;imgLoad.src="images/database_go.png";var imgDatabase=new Image;imgDatabase.src="images/database.png";var imgReplace=new Image;imgReplace.src="images/database_refresh.png";var imgRemove=new Image;imgRemove.src="images/database_delete.png";var imgLoadModule=new Image;imgLoadModule.src="images/module_load.gif"}function clearAllInterval(){for(i=0;i<arrInterval.length;i++)clearInterval(arrInterval.pop());resetStatus()}var statusid=0,standby="ready";
function status(b){oldElem=$("stat"+statusid);p=createP();p.innerHTML=b;p.id="stat"+ ++statusid;p.setAttribute("onclick","clearAllInterval()");p.setAttribute("title","stuck? Click the status until it fixes itself");b==standby?p.setAttribute("style",""):p.setAttribute("style","color:#e30");replaceElem(p,oldElem);opacity(p.id,0,100,100)}function resetStatus(){status(standby)}function replaceElem(b,c,f){f?setTimeout(function(){c.parentNode.replaceChild(b,c)},f):c.parentNode.replaceChild(b,c)}
function showPage2(){opacity("page1",100,0,500);setTimeout("removeElem('page1')",600);setTimeout("revealElem('page2')",700);page2_addBoxes()}function showPage3(){opacity("page2",100,0,500);setTimeout("removeElem('page2')",600);setTimeout("revealElem('page3')",600);setTimeout("revealElem('master')",600)}
function page2_addBoxes(){elemBox=document.getElementById("boxes");for(i=1;i<=Ripper.MAX_RIP_INDEX;i++){div=document.createElement("div");h1=document.createElement("h1");p=document.createElement("p");input=document.createElement("input");img=document.createElement("img");h1.innerHTML="Module "+i;input.setAttribute("type","text");input.setAttribute("maxlength","10");input.id="code"+i;input.className="module_code_box";img.id="img"+i;p.appendChild(input);div.appendChild(img);div.appendChild(h1);div.appendChild(p);
elemBox.appendChild(div);NUSchedule.signals.send("on_module_rip_blank",i)}}function removeElem(b){document.getElementById("page").removeChild(document.getElementById(b))}function revealElem(b){document.getElementById(b).style.display="block"}function opacity(b,c,f,o){o=Math.round(o/100);var g=0;if(c>f)for(i=c;i>=f;i--){setTimeout("changeOpac("+i+",'"+b+"')",g*o);g++}else if(c<f)for(i=c;i<=f;i++){setTimeout("changeOpac("+i+",'"+b+"')",g*o);g++}}
function changeOpac(b,c){if(object=document.getElementById(c)){object=object.style;object.opacity=b/100;object.MozOpacity=b/100;object.KhtmlOpacity=b/100;object.filter="alpha(opacity="+b+")"}}function test(b){document.getElementById("tester").innerHTML=b}function testp(b){document.getElementById("tester").innerHTML+=b}
var handlers=function(b){function c(d){d=d.attr("id").split("_");return b("#"+("k_"+d[1]+"_"+d[2]+"_"+d[3]))}function f(d){return c(d).siblings(".module_node_sel").attr("class","module_node")}var o=false,g,q=0,e=0;return{onmousedown:function(d){d=jQuery.browser.msie?window.event:d;var k=jQuery.browser.msie?d.srcElement:d.target;if(k.tagName=="B")k=k.parentNode;if(k.id){var s=b("#"+k.id);if(/(^m_|^n_)/.test(k.id)){g=s.parent();g.fadeTo(100,0.9);var v=g.attr("id").split("_"),A=parseInt(v[1]),x=tt.module[A];
switch(v[2]){case "lec":for(v=0;v<x.lecture.length;v++)tt.showNode(x,x.lecture[v],A,v);break;case "tut":for(v=0;v<x.tutorial.length;v++)tt.showNode(x.code,x.tutorial[v],A,v);break;case "lab":for(v=0;v<x.laboratory.length;v++)tt.showNode(x.code,x.laboratory[v],A,v);break}o=true;q=d.screenX;e=d.screenY}if(/^k_/.test(k.id))if(k.className=="module_node"){k.className="module_node_sel";tt.swapNode(s,f(s))}else if(k.className=="module_node_sel"){k.className="module_node_1";tt.swapNode(s,s,true)}else{k.className=
"module_node";tt.removeNode(s)}switch(k.tagName){case "INPUT":case "A":case "TEXTAREA":case "SELECT":case "OPTION":break;default:return false}}},onmouseup:function(d){d=jQuery.browser.msie?d.srcElement:d.target;if(d.tagName=="B")d=d.parentNode;if(d.id){var k=b("#"+d.id);if(o){for(var s=document.getElementById("tempNodeMaster");s.hasChildNodes();)s.removeChild(s.lastChild);tt.resetTempCell();g.css("left","0px").css("top","0px").fadeTo(100,0.6)}o=false;if(/(^b_|^t_)/.test(d.id)){tt.swapNode(k,g);f(k);
c(k).attr("class","module_node_sel")}}},onmousemove:function(d){if(jQuery.browser.msie)d=window.event;if(o){g.css("left",d.screenX-q+"px");g.css("top",d.screenY-e+"px")}},onmouseover:function(d){d=jQuery.browser.msie?d.srcElement:d.target;if(d.tagName=="B")d=d.parentNode;/(^b_|^t_)/.test(d.id)&&b("#"+d.id).siblings().andSelf().css("backgroundColor","#a55").css("zIndex",30)},onmouseout:function(d){d=jQuery.browser.msie?d.srcElement:d.target;if(d.tagName=="B")d=d.parentNode;/(^b_|^t_)/.test(d.id)&&
b("#"+d.id).siblings().andSelf().css("backgroundColor","#555").css("zIndex",1)}}}($);for(var i in handlers)document[i]=handlers[i];
