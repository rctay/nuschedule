jQuery.ajax=function(b){var c=location.protocol,e=RegExp(c+"//"+location.hostname),o="http"+(/^https/.test(c)?"s":"")+"://query.yahooapis.com/v1/public/yql?callback=?";return function(f){var q=f.url;if(/get/i.test(f.type)&&!/json/i.test(f.dataType)&&!e.test(q)&&/:\/\//.test(q)){f.url=o;f.dataType="json";f.data={q:'select * from html where url="{URL}" and xpath="*"'.replace("{URL}",q+(f.data?(/\?/.test(q)?"&":"?")+jQuery.param(f.data):"")),format:"xml"};if(!f.success&&f.complete){f.success=f.complete;
delete f.complete}f.success=function(k){return function(d){k&&k.call(this,d.results[0].replace(/<script[^>]+?\/>|<script(.|\s)*?\/script>/gi,""),"success",{responseText:d.results[0]})}}(f.success)}return b.apply(this,arguments)}}(jQuery.ajax);if(!Array.indexOf)Array.prototype.indexOf=function(b){for(var c=0;c<this.length;c++)if(this[c]==b)return c;return-1};String.prototype.trim=function(){for(var b=this.replace(/^\s\s*/,""),c=/\s/,e=b.length;c.test(b.charAt(--e)););return b.slice(0,e+1)};
function createP(){return document.createElement("p")}function createDiv(){return document.createElement("div")}var NUSchedule=NUSchedule||{};NUSchedule.signals=NUSchedule.signals||function(b){return{register:function(c,e){var o=function(){e.apply(o,Array.prototype.slice.call(arguments,1))};b(document).bind(c,o);return o},remove:function(c,e){b(document).unbind(c,e)},remove_all:function(c){b(document).unbind(c)},send:function(c,e){b(document).trigger(c,e)}}}(jQuery);
function Module(){this.exam=this.link=this.code="";this.lecture=[];this.tutorial=[];this.laboratory=[]}Module.prototype.hasLecture=function(){return this.lecture.length>0};Module.prototype.hasTutorial=function(){return this.tutorial.length>0};Module.prototype.hasLaboratory=function(){return this.laboratory.length>0};function Session(b,c,e,o,f,q){this.day=parseInt(b);this.start=parseInt(c);this.end=parseInt(e);this.type=parseInt(o);this.place=f;this.cell=q}
function Part(b,c,e){this.title=b;this.type=c;this.session=e}
var Ripper=function(b){var c=/(\w+)\s+From\s+(\d+)\s+hrs\s+to\s+(\d+)\s+hrs\s+in\s+(.+),/,e=function(){var k={MONDAY:1,TUESDAY:2,WEDNESDAY:3,THURSDAY:4,FRIDAY:5,SATURDAY:6,SUNDAY:7};return function(d){return k[d]}}(),o=function(){return function(k,d,g){k={acad_y:k,sem_c:d,mod_c:g};d=[];for(var y in k)d.push(y+"="+k[y]);return"https://aces01.nus.edu.sg/cors/jsp/report/ModuleDetailedInfo.jsp?"+d.join("&")}}(),f=function(k){for(var d=1;d<=12;d++)if(k(d,b("#code"+d)))break},q=function(){this.sPage=this.url=
"";this.auto_start=false};q.prototype.testApplication=function(){this.auto_start||this.start();this.auto_start=true};q.prototype.start=function(){var k=false;f(function(d,g){if(g.val()!="")return k=true});if(k){b("#ripButton").val("Waiting...").mouseup(function(){return false});b("#nextButton").hide();f(function(d,g){g.val()!=""&&NUSchedule.signals.send("on_module_rip_start",d)});this.rip_index=1;tt.module=[];this.rip()}};q.prototype._send_request=function(k){this.url=k;var d=this;b.get(this.url,
function(g){if(g.indexOf("<strong>Module Information</strong>")!=-1){d.sPage=g;d.$page=b(g);d.getModule();NUSchedule.signals.send("on_module_rip_success",d.rip_index)}else NUSchedule.signals.send("on_module_rip_error",d.rip_index);d.ripNext()})};q.prototype.rip=function(){var k=b("#code"+this.rip_index).val().toUpperCase(),d=b("#ay").val(),g=b("#semester").val();if(k!="")this._send_request(o(d,g,k));else{NUSchedule.signals.send("on_module_rip_blank",this.rip_index);this.ripNext()}};q.prototype.getModule=
function(){var k=b("table.tableframe:eq(0)",this.$page),d=b("tr:eq(1)>td:eq(1)",k).text().trim(),g=this.url;k=b("tr:eq(5)>td:eq(1)",k).text().trim().replace(/\s+(A|P)M$/,"");for(var y=this.ripLecture(),x=[],F=[],s=this.ripTutorial(),v=0;v<s.length;v++){s[v].type=="lab"&&F.push(s[v]);s[v].type=="tut"&&x.push(s[v])}s=new Module;s.code=d;s.link=g;s.exam=k;s.lecture=y;s.laboratory=F;s.tutorial=x;tt.module.push(s)};q.prototype.ripLecture=function(){var k=b("table.tableframe:eq(0) ~ table:eq(0)",this.$page),
d=[];b("table",k).each(function(){for(var g=b("td",this).html().split("<br>"),y=g[0].trim().substring(3),x=Math.floor(g.length/2)-1,F=[],s,v,B,A,z,C,D=0;D<x;D++){s=g[D*2+1];v=g[D*2+2];B=[];A=c.exec(s);s=e(A[1]);z=parseInt(A[2]);C=parseInt(A[3]);A=A[4];if(z%100!=0)z-=30;if(C%100!=0)C+=30;v=v.indexOf("EVEN")!=-1?2:v.indexOf("ODD")!=-1?1:0;for(var E=z;E<C;E+=100)B.push("w"+s+"t"+E);F.push(new Session(s,z,C,v,A,B))}d.push(new Part(y,"lec",F))});return d};q.prototype.ripTutorial=function(){var k=b("table.tableframe:eq(0) ~ table:eq(1)",
this.$page),d=[];b("table",k).each(function(){for(var g=b("td",this).html().split("<br>"),y=g[0].trim().substring(3),x=y.indexOf("LABORATORY")!=-1?"lab":"tut",F=Math.floor(g.length/2)-1,s=[],v,B,A,z,C,D,E=0;E<F;E++){v=g[E*2+1];B=g[E*2+2];A=[];z=c.exec(v);v=e(z[1]);C=parseInt(z[2]);D=parseInt(z[3]);z=z[4];B=B.indexOf("EVEN")!=-1?2:B.indexOf("ODD")!=-1?1:0;for(var G=C;G<D;G+=100)A.push("w"+v+"t"+G);s.push(new Session(v,C,D,B,z,A))}d.push(new Part(y,x,s))});return d};q.prototype.ripNext=function(){if(++this.rip_index<=
12)this.rip();else{b("#ripButton").val("Re-Scan All").mouseup(this.start);tt.module.length>0&&b("#nextButton").show();if(this.auto_start){tt.createTable();tt.createAllNode();st.showSetFunctions();showPage3();setTimeout("alert('Here you are. Happy testing! :)')",900)}}};q.MAX_RIP_INDEX=12;return q}($),cellWidth=55,cellHeight=40;
function TimeTable(){this.shortform={lecture:"lec",tutorial:"tut",laboratory:"lab"};this.longform={};for(var b in this.shortform)this.longform[this.shortform[b]]=b;this.module=[];this.fixedArray=[];this.onTableArray=[];this.cell=[];this.resetTable();this.tempCell=[];this.resetTempCell()}TimeTable.prototype.resetTable=function(){this.cell=Array(6);for(i=0;i<6;i++){this.cell[i]=Array(14);for(j=0;j<14;j++)this.cell[i][j]=[0,0,0,0,0,0,0,0,0,0,0,0]}this.fixedArray=[];this.onTableArray=[]};
TimeTable.prototype.createTable=function(){var b=$("<div></div>").attr("id","tableMaster");for(i=0;i<6;i++)for(j=0;j<14;j++)$("<div></div>").addClass("cell").attr("id","w"+(i+1)+"t"+(j*100+800)).css({width:cellWidth-2,height:cellHeight-2,top:i*cellHeight+(i+1)*24,left:j*cellWidth+j}).text(j*100+800).appendTo(b);b.appendTo("#master")};
TimeTable.prototype.createAllNode=function(b,c){(elemNodeMaster=document.getElementById("nodeMaster"))||$("#master").append($("<div></div>").attr("id","nodeMaster")).append($("<div></div>").attr("id","tempNodeMaster")).append($("<div></div>").attr("id","moduleViewer"));if(typeof c=="object"){document.getElementById("nodeMaster").innerHTML="";this.createModuleViewer(b,c);this.resetTable();for(r=0;r<c.length;r++){str=c[r];arr=str.split("_");modPos=parseInt(arr[0]);objPos=parseInt(arr[2]);type=arr[1];
fixed=b.indexOf(str)>=0;this.createNode(this.module[modPos].code,this.module[modPos][this.longform[type]][objPos],modPos,objPos,fixed)}}else{this.createModuleViewer();for(m=0;m<this.module.length;m++){moduleCode=this.module[m].code;this.module[m].lecture.length>0&&this.createNode(moduleCode,this.module[m].lecture[0],m,0);this.module[m].tutorial.length>0&&this.createNode(moduleCode,this.module[m].tutorial[0],m,0);this.module[m].laboratory.length>0&&this.createNode(moduleCode,this.module[m].laboratory[0],
m,0)}}};
TimeTable.prototype.createModuleViewer=function(b,c){var e=function(k){var d={lecture:"#eee",tutorial:"#eec",laboratory:"#cee"};innerHTML+='<div style="position:relative">';for(n=0;n<this.module[m][k].length;n++)if(this.module[m][k][n].session.length!=0){q+=Math.floor(n/6)*17;l=n%6*21;mat=/\[(.+)\]/.exec(this.module[m][k][n].title)[1];sel=n==0?"_sel":"";if(hasArray){sel=c.indexOf(m+"_"+this.shortform[k]+"_"+n)>=0?"_sel":"";sel=b.indexOf(m+"_"+this.shortform[k]+"_"+n)>=0?"_1":sel}id="k_"+m+"_"+this.shortform[k]+
"_"+n;innerHTML+='<div id="'+id+'" class="module_node'+sel+'" style="top:'+q+"px;left:"+l+"px;background-color:"+d[k]+';">'+mat+"</div>"}innerHTML+="</div>";q+=20};elemModuleViewer=document.getElementById("moduleViewer");elemModuleViewer.innerHTML="";p=document.createElement("p");p.setAttribute("style","position:absolute;top:390px;left:25px;color:#f30;font-size:12px;");p.innerHTML="Take note of the exam date! It may be wrong due to outdated CORS Module Listing. Use this application only after CORS has updated it";
elemModuleViewer.appendChild(p);hasArray=typeof c!="undefined";for(m=0;m<this.module.length;m++){var o=Math.floor(m/6)*115+420,f=m%6*130+25;elemModule=document.createElement("div");elemModule.className="module";elemModule.setAttribute("style","top:"+o+"px;left:"+f+"px;");innerHTML='<div class="colorChooser" style="background-color:'+backgroundColor[m]+';"></div>';innerHTML+="<h5>"+this.module[m].code+"&nbsp;<small>"+this.module[m].exam+"</small></h5>";var q=0;this.module[m].hasLecture()&&e.call(this,
"lecture");this.module[m].hasTutorial()&&e.call(this,"tutorial");this.module[m].hasLaboratory()&&e.call(this,"laboratory");elemModule.innerHTML=innerHTML;elemModuleViewer.appendChild(elemModule)}};
TimeTable.prototype.createNode=function(b,c,e,o,f){(f=f||false)&&this.fixedArray.push(e+"_"+c.type+"_"+o);this.onTableArray.push(e+"_"+c.type+"_"+o);elemNodeMaster=document.getElementById("nodeMaster");elemSubNode=document.createElement("div");for(i=0;i<c.session.length;i++){sessionLength=c.session[i].cell.length;startingCell=c.session[i].cell[0];title=this.shortenTitle(c.title);innerHTML="<b>"+b+"</b><br/>"+title+"<br/>"+c.session[i].place;elem=document.getElementById(startingCell);t=parseInt(elem.style.top)+
1;l=parseInt(elem.style.left)+1;w=cellWidth*sessionLength-(10-sessionLength);h=cellHeight-6;nodeId=f?"f_":"n_";nodeId+=e+"_"+c.type+"_"+o+"_"+c.session[i].cell[0];elemNode=document.createElement("div");elemNode.className=f?"fixedNode":"node";elemNode.setAttribute("id",nodeId);elemNode.setAttribute("style","left:"+l+"px;top:"+t+"px;width:"+w+"px;height:"+h+"px;background-color:"+backgroundColor[e]+";color:"+fontColor[e]);elemNode.innerHTML=innerHTML;if(!f){this.signupTab(startingCell,"n_"+e+"_"+c.type+
"_"+o);tabNumber=this.getTab(startingCell,"n_"+e+"_"+c.type+"_"+o)+1;tabTop=tabNumber>3?parseInt(t)+cellHeight:t-10;tabLeft=tabNumber>3?parseInt(l)+19*(tabNumber-4):parseInt(l)+19*(tabNumber-1);tabId=f?"e_":"m_";tabId+=e+"_"+c.type+"_"+o+"_"+i;elemTab=document.createElement("div");elemTab.className=f?"fixedNodeTab":"tab";elemTab.setAttribute("id",tabId);elemTab.setAttribute("style","left:"+tabLeft+"px;top:"+tabTop+"px;width:17px;height:10px;background-color:"+backgroundColor[e]);elemSubNode.appendChild(elemTab)}subNodeId=
"s_"+e+"_"+c.type+"_"+o;elemSubNode.className="subNode";elemSubNode.setAttribute("id",subNodeId);elemSubNode.appendChild(elemNode)}elemNodeMaster.appendChild(elemSubNode)};
TimeTable.prototype.showNode=function(b,c,e,o){elemTempNodeMaster=document.getElementById("tempNodeMaster");elemSubNode=document.createElement("div");if(!(this.fixedArray.indexOf(e+"_"+c.type+"_"+o)>=0))for(i=0;i<c.session.length;i++){sessionLength=c.session[i].cell.length;startingCell=c.session[i].cell[0];startingTime=parseInt(startingCell.substring(3,startingCell.length));zIndex=Math.floor(startingTime/100);/\[(.+)\]/.test(c.title);classNumber=RegExp.$1;innerHTML="<b>"+b+"</b><br/>"+this.shortenTitle(c.title)+
"<br/>"+c.session[i].place;elem=document.getElementById(startingCell);t=parseInt(elem.style.top)+1;l=parseInt(elem.style.left)+1;w=cellWidth*sessionLength-(7-sessionLength);h=cellHeight-6;nodeId="b_"+e+"_"+c.type+"_"+o+"_"+i;elemNode=document.createElement("div");elemNode.className="tempNode";elemNode.setAttribute("id",nodeId);elemNode.setAttribute("style","left:"+l+"px;top:"+t+"px;width:"+w+"px;height:"+h+"px;z-index:"+zIndex);elemNode.innerHTML=innerHTML;this.signupTempCell(startingCell);tabNumber=
this.getTempCell(startingCell);tabTop=tabNumber>3?parseInt(t)+cellHeight:t-10;tabLeft=tabNumber>3?parseInt(l)+19*(tabNumber-4):parseInt(l)+19*(tabNumber-1);tabId="t_"+e+"_"+c.type+"_"+o+"_"+i;elemTab=document.createElement("div");elemTab.className="tempTab";elemTab.innerHTML=classNumber;elemTab.setAttribute("id",tabId);elemTab.setAttribute("style","left:"+tabLeft+"px;top:"+tabTop+"px;width:17px;height:10px;");elemSubNode.appendChild(elemNode);elemSubNode.appendChild(elemTab);elemTempNodeMaster.appendChild(elemSubNode)}};
TimeTable.prototype.swapNode=function(b,c,e){arrElemId=c.attr("id").split("_");elemId="s_"+arrElemId[1]+"_"+arrElemId[2]+"_"+arrElemId[3];$("#"+elemId).remove();e=e||false;arrT=b.attr("id").split("_");mid=parseInt(arrT[1]);type=arrT[2];oid=parseInt(arrT[3]);this.createNode(this.module[mid].code,this.module[mid][this.longform[type]][oid],mid,oid,e)};
TimeTable.prototype.shortenTitle=function(b){if(/LECTURE Class \[(.+)\]/.test(b))b="LEC ["+RegExp.$1+"]";else if(/SECTIONAL TEACHING Class \[(.+)\]/.test(b))b="LEC ["+RegExp.$1+"]";else if(/DESIGN TUTORIAL Class \[(.+)\]/.test(b))b="D. TUT ["+RegExp.$1+"]";else if(/TUTORIAL Class \[(.+)\]/.test(b))b="TUT ["+RegExp.$1+"]";else if(/LABORATORY Class \[(.+)\]/.test(b))b="LAB ["+RegExp.$1+"]";return b};
TimeTable.prototype.unmark=function(b,c){c="n"+c.substring(1,c.length);for(u=0;u<b.session.length;u++){firstCell=b.session[u].cell[0];theWeek=parseInt(firstCell.substring(1,2));theTime=parseInt(firstCell.substring(3,firstCell.length));col=Math.floor(theTime/100)-8;row=theWeek-1;indexOfId=this.cell[row][col].indexOf(c);this.cell[row][col][indexOfId]=0}};
TimeTable.prototype.removeNode=function(b){if(typeof b=="undefined")return"";nodeId="s"+b.attr("id").substring(1);if(b=document.getElementById(nodeId)){pos=this.fixedArray.indexOf(b.id.substring(2,b.id.length));pos>=0&&this.fixedArray.splice(pos,1);pos=this.onTableArray.indexOf(b.id.substring(2,b.id.length));pos>=0&&this.onTableArray.splice(pos,1);document.getElementById("nodeMaster").removeChild(b);arrOld=b.id.split("_");omid=parseInt(arrOld[1]);otype=arrOld[2];ooid=parseInt(arrOld[3]);this.unmark(this.module[omid][this.longform[otype]][ooid],
b.id)}};TimeTable.prototype.signupTempCell=function(b){theWeek=parseInt(b.substring(1,2));theTime=parseInt(b.substring(3,b.length));col=Math.floor(theTime/100)-8;row=theWeek-1;this.tempCell[row][col]++};TimeTable.prototype.getTempCell=function(b){theWeek=parseInt(b.substring(1,2));theTime=parseInt(b.substring(3,b.length));col=Math.floor(theTime/100)-8;row=theWeek-1;return this.tempCell[row][col]};
TimeTable.prototype.resetTempCell=function(){this.tempCell=Array(6);for(i=0;i<6;i++){this.tempCell[i]=Array(14);for(j=0;j<14;j++)this.tempCell[i][j]=0}};TimeTable.prototype.signupTab=function(b,c){theWeek=parseInt(b.substring(1,2));theTime=parseInt(b.substring(3,b.length));col=Math.floor(theTime/100)-8;row=theWeek-1;indexOfZero=this.cell[row][col].indexOf(0);this.cell[row][col][indexOfZero]=c};
TimeTable.prototype.getTab=function(b,c){theWeek=parseInt(b.substring(1,2));theTime=parseInt(b.substring(3,b.length));col=Math.floor(theTime/100)-8;row=theWeek-1;return this.cell[row][col].indexOf(c)};function Set(){this.maxSlot=3;this.ripModule=[];this.ripMax=this.ripIndex=0;this.fixedArray=[];this.onTableArray=[]}
Set.prototype.load=function(b){if(confirm("Confirm to load previously saved timetable to current table?\n\nCurrent timetable will be discarded")){setRowFunction=document.getElementById("setRow_function"+b);$("#master").fadeOut(200);arrModule=this.getModuleInfo(b);tt.module=[];this.ripIndex=0;this.ripMax=arrModule.length;this.ripModule=arrModule;this.fixedArray=this.getFixedArray(b);this.onTableArray=this.getOnTableArray(b);this.rip()}};
Set.prototype.rip=function(){ripper.url=this.ripModule[this.ripIndex].split("z")[1];this.request("readModule.php?url="+escape(ripper.url))};Set.prototype.save=function(b){if(confirm("Save current timetable into slot #"+(b+1)+"?")){this.saveCookie(b);this.updateFunctions(b)}};Set.prototype.remove=function(b){if(confirm("Remove slot #"+(b+1)+" from cookie?")){this.removeCookie(b);this.updateFunctions(b)}};
Set.prototype.renderButton=function(b,c,e){img=document.createElement("img");img.setAttribute("src",b);a=document.createElement("a");a.setAttribute("href","javascript://");a.setAttribute("onclick",c);a.setAttribute("title",e);a.appendChild(img);return a};Set.prototype.aLoad=function(b,c){return this.renderButton(imgLoad.src,"st.load("+b+")","load "+c.join(", "))};Set.prototype.aReplace=function(b){return this.renderButton(imgSave.src,"st.save("+b+")","replace")};
Set.prototype.aRemove=function(b){return this.renderButton(imgRemove.src,"st.remove("+b+")","remove")};Set.prototype.aSave=function(b){return this.renderButton(imgSave.src,"st.save("+b+")","save")};
Set.prototype.updateFunctions=function(b){for(setRowFunction=document.getElementById("setRow_function"+b);setRowFunction.hasChildNodes();)setRowFunction.removeChild(setRowFunction.lastChild);arrModuleCode=this.readModuleCode(b);if(arrModuleCode.length>0){setRowFunction.appendChild(this.aLoad(b,arrModuleCode));setRowFunction.appendChild(this.aReplace(b));setRowFunction.appendChild(this.aRemove(b))}else setRowFunction.appendChild(this.aSave(b))};
Set.prototype.renderSetRow=function(){var b=document.getElementById("setRow");table=document.createElement("table");tr=document.createElement("tr");for(i=0;i<this.maxSlot;i++){td=document.createElement("td");img1=document.createElement("img");img1.setAttribute("src",imgDatabase.src);span=document.createElement("span");span.id="setRow_function"+i;arrModuleCode=this.readModuleCode(i);arrModuleCode.length>0&&span.appendChild(this.aLoad(i,arrModuleCode));td.appendChild(img1);td.appendChild(span);tr.appendChild(td)}table.appendChild(tr);
b.appendChild(table)};Set.prototype.showSetFunctions=function(){for(i=0;i<this.maxSlot;i++){setRowFunction=document.getElementById("setRow_function"+i);if(setRowFunction.hasChildNodes()){setRowFunction.appendChild(this.aReplace(i));setRowFunction.appendChild(this.aRemove(i))}else setRowFunction.appendChild(this.aSave(i))}};
Set.prototype.readModuleCode=function(b){arr=this.getModuleInfo(b);if(typeof arr[0]=="undefined"||arr[0]=="")return[];code=[];for(p=0;p<arr.length;p++)code.push(arr[p].split("z")[0]);return code};Set.prototype.saveCookie=function(b){u=this.ripModuleInfo()+"-"+this.ripOnTableArray()+"-"+this.ripFixedArray();setCookie("module_set"+b,u,new Date(Date.parse("Jan 1, 2010")))};Set.prototype.removeCookie=function(b){setCookie("module_set"+b,"",new Date(Date.parse("Jan 1, 2010")))};
Set.prototype.ripModuleInfo=function(){str="";for(i=0;i<tt.module.length;i++)str+=tt.module[i].code+"z"+tt.module[i].link+"x";return str.substring(0,str.length-1)};Set.prototype.getModuleInfo=function(b){str=getCookie("module_set"+b);if(str==null)return[];str=str.split("-")[0];return str.split("x")};Set.prototype.ripOnTableArray=function(){str=tt.onTableArray.join(".");str=str.replace(/_lec_/g,"h");str=str.replace(/_tut_/g,"o");return str=str.replace(/_lab_/g,"j")};
Set.prototype.getOnTableArray=function(b){str=getCookie("module_set"+b);if(str==null)return[];str=str.split("-")[1];str=str.replace(/j/g,"_lab_");str=str.replace(/o/g,"_tut_");str=str.replace(/h/g,"_lec_");return str.split(".")};Set.prototype.ripFixedArray=function(){str=tt.fixedArray.join(".");str=str.replace(/_lec_/g,"h");str=str.replace(/_tut_/g,"o");return str=str.replace(/_lab_/g,"j")};
Set.prototype.getFixedArray=function(b){str=getCookie("module_set"+b);if(str==null)return[];str=str.split("-")[2];str=str.replace(/j/g,"_lab_");str=str.replace(/o/g,"_tut_");str=str.replace(/h/g,"_lec_");return str.split(".")};
Set.prototype.request=function(b){$.get(b,function(c){if(/Module Detailed Information for/i.test(c)){ripper.sPage=c;ripper.getModule();if(++st.ripIndex<st.ripMax)st.rip();else{$("#page1").fadeOut(300);$("#page2").fadeOut(300);setTimeout(function(){if(!document.getElementById("tableMaster")){tt.createTable();st.showSetFunctions()}tt.createAllNode(st.fixedArray,st.onTableArray);$("#page3").fadeIn(200);$("#master").fadeIn(200)},500)}}})};
function setCookie(b,c,e,o,f,q){b=b+"="+encodeURIComponent(c);if(e)b+="; expires="+e.toGMTString();if(o)b+="; path="+o;if(f)b+="; domain="+f;if(q)b+="; secure";document.cookie=b}function getCookie(b){return RegExp("(?:; )?"+b+"=([^;]*);?").test(document.cookie)?decodeURIComponent(RegExp.$1):null}
var reLink=/https:\/\/sit.aces01.nus.edu.sg\/cors\/jsp\/report\/ModuleDetailedInfo.jsp\?acad_y=(.+)&sem_c=(\d)&mod_c=(.+)/,tt=new TimeTable,ripper=new Ripper,st=new Set,arrInterval=[],backgroundColor=["#fc9","#cc9","#c9f","#f9f","#cfc","#9c9","#99f","#999","#696","#606","#933","#009"],fontColor=["#000","#000","#000","#000","#000","#000","#000","#000","#000","#fff","#fff","#fff"];
if(document.images){NUSchedule.signals.register("on_module_rip_start",function(b){$("#img"+b).attr("src","images/loader.gif")});NUSchedule.signals.register("on_module_rip_success",function(b){$("#img"+b).attr("src","images/accept.png")});NUSchedule.signals.register("on_module_rip_error",function(b){$("#img"+b).attr("src","images/exclamation.png")});NUSchedule.signals.register("on_module_rip_blank",function(b){$("#img"+b).attr("src","images/blank.gif")});var imgSave=new Image;imgSave.src="images/database_save.png";
var imgLoad=new Image;imgLoad.src="images/database_go.png";var imgDatabase=new Image;imgDatabase.src="images/database.png";var imgReplace=new Image;imgReplace.src="images/database_refresh.png";var imgRemove=new Image;imgRemove.src="images/database_delete.png";var imgLoadModule=new Image;imgLoadModule.src="images/module_load.gif"}function clearAllInterval(){for(i=0;i<arrInterval.length;i++)clearInterval(arrInterval.pop());resetStatus()}var statusid=0,standby="ready";
function status(b){oldElem=$("stat"+statusid);p=createP();p.innerHTML=b;p.id="stat"+ ++statusid;p.setAttribute("onclick","clearAllInterval()");p.setAttribute("title","stuck? Click the status until it fixes itself");b==standby?p.setAttribute("style",""):p.setAttribute("style","color:#e30");replaceElem(p,oldElem);opacity(p.id,0,100,100)}function resetStatus(){status(standby)}function replaceElem(b,c,e){e?setTimeout(function(){c.parentNode.replaceChild(b,c)},e):c.parentNode.replaceChild(b,c)}
function leaveComment(){commentBody=$("comment_body");commentLink=$("comment_link");if(commentBody.style.display=="block"){opacity(commentBody.id,100,0,100);opacity(commentLink.id,100,0,100);setTimeout(function(){commentBody.style.display="none";opacity(commentLink.id,0,100,100);commentLink.innerHTML='<img src="images/comment.png" alt="icon" />Leave comments'},100)}else{commentBody.style.display="block";commentLink.innerHTML='<img src="images/cross.png" alt="icon" />Close';opacity(commentBody.id,
0,100,100);opacity(commentLink.id,0,100,100);$("comment_name").focus()}}
function sendComment(){commentName=$("comment_name");commentEmail=$("comment_email");commentContent=$("comment_content");if(commentName.value.trim()=="")commentName.style.borderColor="#f33";else if(commentEmail.value.trim()=="")commentEmail.style.borderColor="#f33";else if(commentContent.value.trim()=="")commentContent.style.borderColor="#f33";else{str="name="+commentName.value+"&email="+commentEmail.value+"&content="+commentContent.value;xmlhttp=createxmlhttp();xmlhttp.open("POST","sendEmail.php",
true);xmlhttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){p=xmlhttp.responseText;commentFeedback=$("comment_feedback");commentBody=$("comment_body");commentLink=$("comment_link");commentFeedback.innerHTML=p=="success"?"<p>Comment sent!</p>":'<p style="color:red">Fail to send, please try again</p>';commentBody.style.display="none";commentLink.style.display="none";commentFeedback.style.display=
"block";opacity(commentFeedback.id,0,100,100);setTimeout(function(){commentFeedback.style.display="none";commentLink.style.display="block";opacity(commentLink.id,0,100,100);commentLink.innerHTML='<img src="images/comment.png" alt="icon" />Leave comments'},2E3);commentContent.value=""}};xmlhttp.send(str);xmlreq=new CXMLReq("",xmlhttp);xmlreqs.push(xmlreq)}}function showPage2(){opacity("page1",100,0,500);setTimeout("removeElem('page1')",600);setTimeout("revealElem('page2')",700);page2_addBoxes()}
function showPage3(){opacity("page2",100,0,500);setTimeout("removeElem('page2')",600);setTimeout("revealElem('page3')",600);setTimeout("revealElem('master')",600)}
function page2_addBoxes(){elemBox=document.getElementById("boxes");for(i=1;i<=Ripper.MAX_RIP_INDEX;i++){div=document.createElement("div");h1=document.createElement("h1");p=document.createElement("p");input=document.createElement("input");img=document.createElement("img");h1.innerHTML="Module "+i;input.setAttribute("type","text");input.setAttribute("maxlength","10");input.id="code"+i;input.className="txtbox";img.id="img"+i;p.appendChild(input);div.appendChild(img);div.appendChild(h1);div.appendChild(p);
elemBox.appendChild(div);NUSchedule.signals.send("on_module_rip_blank",i)}}function removeElem(b){document.getElementById("page").removeChild(document.getElementById(b))}function revealElem(b){document.getElementById(b).style.display="block"}function opacity(b,c,e,o){o=Math.round(o/100);var f=0;if(c>e)for(i=c;i>=e;i--){setTimeout("changeOpac("+i+",'"+b+"')",f*o);f++}else if(c<e)for(i=c;i<=e;i++){setTimeout("changeOpac("+i+",'"+b+"')",f*o);f++}}
function changeOpac(b,c){if(object=document.getElementById(c)){object=object.style;object.opacity=b/100;object.MozOpacity=b/100;object.KhtmlOpacity=b/100;object.filter="alpha(opacity="+b+")"}}function test(b){document.getElementById("tester").innerHTML=b}function testp(b){document.getElementById("tester").innerHTML+=b}
var handlers=function(b){function c(d){arrElemId=d.attr("id").split("_");elemId="k_"+arrElemId[1]+"_"+arrElemId[2]+"_"+arrElemId[3];return b("#"+elemId)}function e(d){return c(d).siblings(".module_node_sel").attr("class","module_node")}var o=false,f,q=0,k=0;return{onmousedown:function(d){d=jQuery.browser.msie?window.event:d;targetElem=jQuery.browser.msie?d.srcElement:d.target;if(targetElem.tagName=="B")targetElem=targetElem.parentNode;jObj=b("#"+targetElem.id);if(/(^m_|^n_)/.test(targetElem.id)){f=
jObj.parent();f.fadeTo(100,0.9);var g=f.attr("id").split("_"),y=parseInt(g[1]),x=tt.module[y];switch(g[2]){case "lec":for(g=0;g<x.lecture.length;g++)tt.showNode(x,x.lecture[g],y,g);break;case "tut":for(g=0;g<x.tutorial.length;g++)tt.showNode(x.code,x.tutorial[g],y,g);break;case "lab":for(g=0;g<x.laboratory.length;g++)tt.showNode(x.code,x.laboratory[g],y,g);break}o=true;q=d.screenX;k=d.screenY}if(/^k_/.test(targetElem.id))if(targetElem.className=="module_node"){targetElem.className="module_node_sel";
tt.swapNode(jObj,e(jObj))}else if(targetElem.className=="module_node_sel"){targetElem.className="module_node_1";tt.swapNode(jObj,jObj,true)}else{targetElem.className="module_node";tt.removeNode(jObj)}switch(targetElem.tagName){case "INPUT":case "A":case "TEXTAREA":case "SELECT":case "OPTION":break;default:return false}},onmouseup:function(d){targetElem=jQuery.browser.msie?d.srcElement:d.target;if(targetElem.tagName=="B")targetElem=targetElem.parentNode;jObj=b("#"+targetElem.id);if(o){for(tempNodeMaster=
document.getElementById("tempNodeMaster");tempNodeMaster.hasChildNodes();)tempNodeMaster.removeChild(tempNodeMaster.lastChild);tt.resetTempCell();f.css("left","0px").css("top","0px").fadeTo(100,0.6)}o=false;if(/(^b_|^t_)/.test(targetElem.id)){tt.swapNode(jObj,f);e(jObj);c(jObj).attr("class","module_node_sel")}},onmousemove:function(d){if(jQuery.browser.msie)d=window.event;if(o){f.css("left",d.screenX-q+"px");f.css("top",d.screenY-k+"px")}},onmouseover:function(d){targetElem=jQuery.browser.msie?d.srcElement:
d.target;if(targetElem.tagName=="B")targetElem=targetElem.parentNode;jObj=b("#"+targetElem.id);/(^b_|^t_)/.test(targetElem.id)&&jObj.siblings().andSelf().css("backgroundColor","#a55").css("zIndex",30)},onmouseout:function(d){targetElem=jQuery.browser.msie?d.srcElement:d.target;if(targetElem.tagName=="B")targetElem=targetElem.parentNode;jObj=b("#"+targetElem.id);/(^b_|^t_)/.test(targetElem.id)&&jObj.siblings().andSelf().css("backgroundColor","#555").css("zIndex",1)}}}($);
for(var i in handlers)document[i]=handlers[i];
